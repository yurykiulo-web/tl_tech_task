
# Кейс 2: правила работы с Git

## Описание
Данный документ содержит правила работы с Git репозиторием применяемым на проекте "Кейс1". Данные правила обязательны к применению всеми участниками проекта и являются базой для работы с системой контроля версий. Любые улучшения касательно описанных ниже правил, которые способствуют улучшению, качества разработки обсуждаются всей командой и принимаются в случае одобрения большинством голосов и ТЛ.

## Роли
На проекте используются следующие роли
- **ТЛ** - техлид проекта
- **ТЛС** - помошник техлида проекта
- **Д** - девелопер
- **ИК** - инженер по качеству
- **ДО** - девопс инженер
- **ПМ** - менеджер проекта

## Основные ветки и их типы
- **main** - главная ветка репозитория, хранящая стабильные версии значимых релизов
- **release_X** - содержит конкретный релиз проекта 
- **develop** - основная ветка для разрабтки
- **feature/ECticketNumber-short_descr** - ветка содержащая код конкретного тикета, может содержать всю фичу либо её часть
- **bug/ECticketNumber-short_descr** - ветка содержащая код фикса конкретного бага
- **hotfix/ECticketNumber-short_descr** - ветка содержащая код хотфикса

## Виды прав доступа
На проекте существует 4 типа прав доступа
- **Администратор** - вид доступа позволяющий любые операции с любыми ветками, а также администрирование юзеров репозитория и его конфигурирование
- **Расширенный** - вид доступа позволяющий любые операции с любыми ветками
- **Стандартный** - включает все необходимие для разработки проекта действия за исключением аппрува\мержа в ветки **release_X**  и **main** и работы с этими ветками. Таже этот доступ подразумевает запрет на любые действия в **develop**, которые могут изменить принудительно его историю коммитов (например force, reset, amend и т.д.)
- **Чтение** - вид доступа только для чтения


## Правила работы с ветками репозитория
Работа с репозиторием основывается на 'Git Flow' модели, адаптированной для текущего проекта.
**Д**, начав работу над таском должен создать новую ветку, отбранчевав её от свежего **девелоп** бранча. Имя ветки должно соответствовать описанию из раздела **Основные ветки и их типы**. Закончив работу с таском, **Д** создаёт Пулл Реквест (**ПР**) и переключается на работу над следующим таском. Принципы работы с **ПР** и их формат будут описаны в других разделах и документах, которые можно найти в ветке **tasks** проекта **tl_tech_tasks** (Процесс ревью кода - отдельный документ не включенный в данный скоп). Получив все необходимые аппрувы, **Д** мержит свой код в **девелоп** используя **-ff** опцию, если иного не оговорено в рамках тикета. По окончании мержа, **Д** удаляет свою ветку. Для слияния веток используем **merge** команду

- **Д** имеет **Стандартный** доступ в праве делать любые операции с ветками, которые он создал.
- **ИК** имеет **Стандартный** доступ в праве делать любые операции с ветками, которые он создал.
- **ДО** имеет **Стандартный** доступ в праве делать любые операции с ветками, которые он создал.
- **ПМ** имеет **Чтение** доступ только на чтение с любыми ветками.
- **ТЛС** имеет **Расширенный** доступ в праве делать любые операции с любыми ветками
- **ТЛ** имеет доступ уровня **Администратор** и может делегировать свои полномочия одному из членов команды на короткий период времени.


## Политика аппрувов ПРов
На данный момент нет ясности о количестве подкоманд и их технологическом стеке на проекте и политика аппрувов носит общий характер и может быть уточнена в дальнейшем

 - Любая подкоманда, которая состоит из 1 **Д**: аппрув ПРов этой команды осуществляется **ТЛ** и или **ТЛС**, которые имеет экспертизу в этом стеке, если экспертиза в требуемом стеке есть только у 1 **Д** - **ТЛ** решает вопрос о привлечении экспертов из соответствующих отделов для проведения регулярных код ревью сессий
 - Любая подкоманда, которая состоит из 2 и более **Д** ппрув ПРов этой команды включает 1 аппрув от **Д** для обычных тасков и 2 аппрува (**Д** + **ТЛ** \ **ТЛС** ) для критичных тасков. Если экспертиза в требуемом стеке есть только у 2 **Д** - **ТЛ** решает вопрос о привлечении экспертов из соответствующих отделов для проведения регулярных код ревью сессий для критичных тасков
Любые аппрувы и мержи в ветки **release_X**, **hotfix** или **main** осуществляются исключительно **ТЛ**


## Политика работы с ветками при подготовке релизов
Подготовка релизов включает в себя ряд действий выходящих за рамки данного документа, которые могут быть добавлены ссылками здесь в случае необходимости.
Применительно к репозиторию подготовка релиза включает в себя создание ветки релиза от ветки **develop**. После того как ветка релиза прошла проверку качества мы принимаем решение о выходе этого релиза. В этом случае мы мержим ветку релиза в **main** ветку и создаём в ней аннотиованный тэг с именем соответствующего релиза. Обращаю внимание, что ветка релиза Не удаляется и продолжает существовать на протяжении всего времени проекта, если иное не согласовано с заказчиками.
После этого мержа мы делаем слияние ветки релиза в **develop**, чтобы "выровнять" ветки **develop** и **main**. Обращаю внимание, что ветка **develop** может иметь уже новые изменения внесенные коммандой разработки - это обычная практика и необходимо только обратить пристальное внимание на разрешение конфликтов в коде, которые могут возникнуть при операциях слияния. Разрешение конфликтов - это приоритетная операция, она описана ниже в разделе **Политика работы конфликтами кода**.


## Политика работы с ветками при подготовке хотфиксов
Хотфиксы применяются к самому свежему релизу (в контексте данного документа мы рассматриваем упрощённую схему деливери, включающую в себя только 1 ПРОД энвайронмент). Для началы работы над хотфиксом используется ветка **main**. Из этой ветки берётся код помеченный тэгом соответствующего релиза и от него бранчуется ветка **hotfix/ECticketNumber-short_descr**. После проверки качества этой ветки - производим слияние ветки **hotfix** в **main** и **develop**. Ветка хотфикса Не удаляется и продолжает существовать на протяжении всего времени проекта, если иное не согласовано с заказчиками.


## Политика работы с конфликтами в коде
Решение конфликтов кода при операциях слияния веток имеет приоритетное значение и должна решаться в 1ю очередь. При подготовке релизов\хотфиксов, вся команда должна быть доступна для помощи быстрого решения возможных конфликтов при слиянии веток.

Если кто-то из команды разработки, в процессе работы, стакливается с конфликтами в коде, при получении свежей версии из репозитория и нет возможности решить эти конфликты в течение 45 минут - он\она должен запросить помощь коллеги, чей код вызвал конфликты, для быстрого анализа конфликтующего кода и правильного, и безопасного его слияния.